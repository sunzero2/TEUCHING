<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Message">
	<insert id="insertMatchMessage" parameterType="Message">
		INSERT INTO
				TR_MESSAGE
		VALUES(
				S_MESSAGE_IDX.NEXTVAL
				, #{tr_email}
				, #{mem_email}
				, #{msg_cont}
				, SYSDATE
				, MEMBER
		)
	</insert>
	
	<insert id="insertMatch" parameterType="Match">
		INSERT INTO
				TR_MATCH
		VALUES(
				S_MATCH_IDX.NEXTVAL
				, #{tr_email}
				, #{mem_email}
				, #{match_date}
				, #{match_time}
				,'N'
		)
	</insert>
	
	<select id="selectMsgBoxSend" resultType="Message">
		SELECT 
			*
		FROM
			(SELECT
				ROWNUM RNUM, N1.*
			FROM
				(SELECT 
						* 
				FROM
					TR_MESSAGE
				<if test="WRITER == 'Trainer' ">
				WHERE 
					 TR_EMAIL = #{email}
				</if>
				<if test="WRITER == 'Member'">
				WHERE 
					 MEM_EMAIL = #{email}
				</if>
				ORDER BY 
					WRITE_DATE DESC
				)N1
			)
		WHERE
			RNUM BETWEEN #{paging.start} AND #{paging.end}
	</select>
	
	<select id="selectMsgBoxRecv" >
		SELECT
			*
		FROM
			(SELECT
				ROWNUM RNUM, N1.*
			FROM
				(SELECT
						*
				FROM
					TR_MESSAGE
				ORDER BY
					WRITE_DATE DESC
				)
			N1)
		WHERE
			RNUM BETWEEN #{start} AND #{end}
	</select>
	
	<select id="selectMsgCnt" resultType="int">
		SELECT
			COUNT(*)
		FROM
			TR_MESSAGE
	</select>
	
</mapper>
